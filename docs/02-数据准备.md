# 02-æ•°æ®å‡†å¤‡

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•ä¸‹è½½å’Œå‡†å¤‡ Qlib æ‰€éœ€çš„ A è‚¡å’Œç¾è‚¡æ•°æ®ã€‚

## ä¸€ã€æ•°æ®æ¦‚è¿°

Qlib æ”¯æŒä¸¤ç§å¸‚åœºçš„æ•°æ®ï¼š
- **A è‚¡å¸‚åœºï¼ˆcnï¼‰**ï¼šä¸­å›½Aè‚¡å¸‚åœºæ•°æ®
- **ç¾è‚¡å¸‚åœºï¼ˆusï¼‰**ï¼šç¾å›½è‚¡ç¥¨å¸‚åœºæ•°æ®

æ•°æ®æ¥æºä¸»è¦æ˜¯ Yahoo Financeï¼ŒQlib ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶è½¬æ¢ä¸ºä¸“ç”¨çš„äºŒè¿›åˆ¶æ ¼å¼ï¼ˆ.binï¼‰ã€‚

## äºŒã€æ•°æ®ä¸‹è½½æ–¹æ³•

Qlib æä¾›äº†ä¸¤ç§æ–¹å¼ä¸‹è½½æ•°æ®ï¼š

### æ–¹æ³•1ï¼šä½¿ç”¨ qlib.run.get_data æ¨¡å—ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•å’Œæ¨èçš„æ–¹å¼ï¼š

#### A è‚¡æ•°æ®ä¸‹è½½

```bash
python -m qlib.run.get_data qlib_data \
    --target_dir ~/.qlib/qlib_data/cn_data \
    --region cn
```

#### ç¾è‚¡æ•°æ®ä¸‹è½½

```bash
python -m qlib.run.get_data qlib_data \
    --target_dir ~/.qlib/qlib_data/us_data \
    --region us
```

### æ–¹æ³•2ï¼šä½¿ç”¨ scripts/get_data.py è„šæœ¬

å¦‚æœæ‚¨æ˜¯ä»æºç å®‰è£…çš„ Qlibï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬æ–¹å¼ï¼š

#### A è‚¡æ•°æ®ä¸‹è½½

```bash
# è¿›å…¥ qlib æºç ç›®å½•
cd /path/to/qlib

# ä¸‹è½½ A è‚¡æ•°æ®
python scripts/get_data.py qlib_data \
    --target_dir ~/.qlib/qlib_data/cn_data \
    --region cn
```

#### ç¾è‚¡æ•°æ®ä¸‹è½½

```bash
# è¿›å…¥ qlib æºç ç›®å½•
cd /path/to/qlib

# ä¸‹è½½ç¾è‚¡æ•°æ®
python scripts/get_data.py qlib_data \
    --target_dir ~/.qlib/qlib_data/us_data \
    --region us
```

## ä¸‰ã€å‚æ•°è¯´æ˜

### --target_dir
æŒ‡å®šæ•°æ®å­˜å‚¨çš„ç›®æ ‡ç›®å½•ã€‚é»˜è®¤è·¯å¾„ä¸º `~/.qlib/qlib_data/`ã€‚

**å»ºè®®è·¯å¾„**ï¼š
- A è‚¡ï¼š`~/.qlib/qlib_data/cn_data`
- ç¾è‚¡ï¼š`~/.qlib/qlib_data/us_data`

### --region
æŒ‡å®šå¸‚åœºåŒºåŸŸï¼š
- `cn`ï¼šA è‚¡å¸‚åœº
- `us`ï¼šç¾è‚¡å¸‚åœº

### å…¶ä»–å¯é€‰å‚æ•°

```bash
# ä¸‹è½½ 1 åˆ†é’Ÿé¢‘ç‡æ•°æ®ï¼ˆé»˜è®¤æ˜¯æ—¥é¢‘æ•°æ®ï¼‰
python -m qlib.run.get_data qlib_data \
    --target_dir ~/.qlib/qlib_data/cn_data_1min \
    --region cn \
    --interval 1min

# æŒ‡å®šåˆ é™¤æ—§æ•°æ®ï¼ˆå¦‚æœç›®å½•å·²å­˜åœ¨ï¼‰
python -m qlib.run.get_data qlib_data \
    --target_dir ~/.qlib/qlib_data/cn_data \
    --region cn \
    --delete_old
```

## å››ã€æ•°æ®ä¸‹è½½è¿‡ç¨‹

### ä¸‹è½½æ—¶é—´

- **A è‚¡æ•°æ®**ï¼šçº¦ 1-2GBï¼Œä¸‹è½½æ—¶é—´å–å†³äºç½‘ç»œé€Ÿåº¦ï¼ˆé€šå¸¸ 10-30 åˆ†é’Ÿï¼‰
- **ç¾è‚¡æ•°æ®**ï¼šæ•°æ®é‡æ›´å¤§ï¼Œå¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´

### ä¸‹è½½è¿‡ç¨‹ç¤ºä¾‹

```
æ­£åœ¨ä¸‹è½½ A è‚¡æ•°æ®...
[========================================] 100%
æ•°æ®è½¬æ¢ä¸­...
[========================================] 100%
æ•°æ®ä¸‹è½½å®Œæˆï¼
æ•°æ®è·¯å¾„: ~/.qlib/qlib_data/cn_data
```

### æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œè¿æ¥**ï¼šç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šï¼Œä¸‹è½½è¿‡ç¨‹ä¸­ä¸è¦ä¸­æ–­
2. **ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘ 5GB ä»¥ä¸Šï¼‰
3. **ä¸‹è½½ä¸­æ–­**ï¼šå¦‚æœä¸‹è½½ä¸­æ–­ï¼Œå¯ä»¥é‡æ–°è¿è¡Œå‘½ä»¤ï¼ŒQlib ä¼šç»§ç»­ä¸‹è½½æœªå®Œæˆçš„éƒ¨åˆ†

## äº”ã€æ•°æ®ç›®å½•ç»“æ„

ä¸‹è½½å®Œæˆåï¼Œæ•°æ®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
~/.qlib/qlib_data/
â”œâ”€â”€ cn_data/              # A è‚¡æ•°æ®
â”‚   â”œâ”€â”€ calendars/        # äº¤æ˜“æ—¥å†
â”‚   â”œâ”€â”€ instruments/      # è‚¡ç¥¨æ± ä¿¡æ¯
â”‚   â””â”€â”€ features/         # ç‰¹å¾æ•°æ®ï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼‰
â””â”€â”€ us_data/              # ç¾è‚¡æ•°æ®
    â”œâ”€â”€ calendars/
    â”œâ”€â”€ instruments/
    â””â”€â”€ features/
```

### å…³é”®ç›®å½•è¯´æ˜

- **calendars/**ï¼šå­˜å‚¨äº¤æ˜“æ—¥å†ï¼Œç”¨äºç¡®å®šå“ªäº›æ—¥æœŸæ˜¯äº¤æ˜“æ—¥
- **instruments/**ï¼šå­˜å‚¨è‚¡ç¥¨æ± ä¿¡æ¯ï¼Œå¦‚ CSI300ã€å…¨å¸‚åœºç­‰
- **features/**ï¼šå­˜å‚¨å®é™…çš„è‚¡ç¥¨æ•°æ®ï¼ˆå¼€ç›˜ä»·ã€æ”¶ç›˜ä»·ã€æˆäº¤é‡ç­‰ï¼‰ï¼Œä»¥äºŒè¿›åˆ¶æ ¼å¼å­˜å‚¨

## å…­ã€éªŒè¯æ•°æ®

ä¸‹è½½å®Œæˆåï¼ŒéªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®ï¼š

### Python éªŒè¯è„šæœ¬

åˆ›å»º `verify_data.py`ï¼š

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
éªŒè¯ Qlib æ•°æ®æ˜¯å¦æ­£ç¡®ä¸‹è½½
"""

import qlib
from qlib.constant import REG_CN, REG_US
from qlib.data import D

def verify_data(provider_uri, region):
    """éªŒè¯æ•°æ®"""
    try:
        # åˆå§‹åŒ– Qlib
        qlib.init(provider_uri=provider_uri, region=region)
        print(f"âœ… Qlib åˆå§‹åŒ–æˆåŠŸï¼ˆåŒºåŸŸ: {region}ï¼‰")

        # è·å–äº¤æ˜“æ—¥å†
        calendar = D.calendar(start_time='2020-01-01', end_time='2020-12-31')
        print(f"âœ… äº¤æ˜“æ—¥å†åŠ è½½æˆåŠŸï¼Œäº¤æ˜“æ—¥æ•°é‡: {len(calendar)}")

        # è·å–è‚¡ç¥¨æ± 
        if region == REG_CN:
            instruments = D.instruments(market='csi300')
        else:
            instruments = D.instruments(market='all')
        print(f"âœ… è‚¡ç¥¨æ± åŠ è½½æˆåŠŸï¼Œè‚¡ç¥¨æ•°é‡: {len(instruments)}")

        # è·å–æ ·æœ¬æ•°æ®
        sample_instruments = list(instruments)[:5]  # å–å‰5åªè‚¡ç¥¨
        data = D.features(
            sample_instruments,
            fields=['$close', '$volume'],
            start_time='2020-01-01',
            end_time='2020-01-10'
        )
        print(f"âœ… æ•°æ®æŸ¥è¯¢æˆåŠŸï¼Œæ ·æœ¬æ•°æ®å½¢çŠ¶: {data.shape}")
        print(f"\næ ·æœ¬æ•°æ®é¢„è§ˆ:\n{data.head()}")

        print(f"\nğŸ‰ æ•°æ®éªŒè¯é€šè¿‡ï¼")
        return True

    except Exception as e:
        print(f"âŒ æ•°æ®éªŒè¯å¤±è´¥: {e}")
        return False

if __name__ == '__main__':
    # éªŒè¯ A è‚¡æ•°æ®
    print("=" * 50)
    print("éªŒè¯ A è‚¡æ•°æ®")
    print("=" * 50)
    verify_data('~/.qlib/qlib_data/cn_data', REG_CN)

    print("\n" + "=" * 50)
    print("éªŒè¯ç¾è‚¡æ•°æ®")
    print("=" * 50)
    # éªŒè¯ç¾è‚¡æ•°æ®ï¼ˆå¦‚æœå·²ä¸‹è½½ï¼‰
    # verify_data('~/.qlib/qlib_data/us_data', REG_US)
```

è¿è¡ŒéªŒè¯ï¼š
```bash
python verify_data.py
```

## ä¸ƒã€æ•°æ®æ›´æ–°

### æ›´æ–°ç°æœ‰æ•°æ®

å¦‚æœéœ€è¦æ›´æ–°æ•°æ®åˆ°æœ€æ–°æ—¥æœŸï¼š

```bash
# æ›´æ–° A è‚¡æ•°æ®
python -m qlib.run.get_data qlib_data \
    --target_dir ~/.qlib/qlib_data/cn_data \
    --region cn \
    --delete_old
```

### å®šæ—¶æ›´æ–°ï¼ˆé«˜çº§ï¼‰

å¯ä»¥ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚ Crontabï¼‰è‡ªåŠ¨æ›´æ–°æ•°æ®ï¼š

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ æ¯æ—¥æ›´æ–°ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ›´æ–°ï¼‰
0 2 * * * python -m qlib.run.get_data qlib_data --target_dir ~/.qlib/qlib_data/cn_data --region cn
```

## å…«ã€å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šä¸‹è½½é€Ÿåº¦æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ç¨³å®šçš„ç½‘ç»œè¿æ¥
- è€ƒè™‘åœ¨ç½‘ç»œè¾ƒå¥½çš„æ—¶é—´æ®µä¸‹è½½
- å¦‚æœä½¿ç”¨ä»£ç†ï¼Œç¡®ä¿ä»£ç†é…ç½®æ­£ç¡®

### é—®é¢˜2ï¼šä¸‹è½½ä¸­æ–­

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é‡æ–°è¿è¡Œä¸‹è½½å‘½ä»¤ï¼ŒQlib ä¼šç»§ç»­æœªå®Œæˆçš„éƒ¨åˆ†
- å¦‚æœå¤šæ¬¡å¤±è´¥ï¼Œå¯ä»¥å°è¯•åˆ é™¤éƒ¨åˆ†æ•°æ®åé‡æ–°ä¸‹è½½

### é—®é¢˜3ï¼šç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ¸…ç†ç£ç›˜ç©ºé—´
- æˆ–è€…å°†æ•°æ®ä¸‹è½½åˆ°å…¶ä»–æœ‰è¶³å¤Ÿç©ºé—´çš„ç›®å½•

### é—®é¢˜4ï¼šæ•°æ®éªŒè¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FileNotFoundError: ...
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ•°æ®è·¯å¾„æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ•°æ®ä¸‹è½½æ˜¯å¦å®Œæ•´
3. å°è¯•é‡æ–°ä¸‹è½½æ•°æ®

### é—®é¢˜5ï¼šæ‰¾ä¸åˆ° instruments

**é”™è¯¯ä¿¡æ¯**ï¼š
```
KeyError: 'csi300'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- A è‚¡å¸‚åœºï¼šä½¿ç”¨ `csi300`, `csi500`, `csi800`, `all` ç­‰
- ç¾è‚¡å¸‚åœºï¼šä½¿ç”¨ `all`, `sp500` ç­‰
- æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®ä¸‹è½½

## ä¹ã€æ•°æ®ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**ï¼šå»ºè®®å…ˆä¸‹è½½ A è‚¡æ•°æ®ï¼Œæ•°æ®é‡è¾ƒå°ï¼Œä¾¿äºå¿«é€Ÿä¸Šæ‰‹
2. **å­¦ä¹ é˜¶æ®µ**ï¼šä½¿ç”¨å®˜æ–¹æä¾›çš„æ•°æ®å³å¯æ»¡è¶³å­¦ä¹ éœ€æ±‚
3. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®ä½¿ç”¨è‡ªå·±çš„æ•°æ®æºï¼Œç¡®ä¿æ•°æ®è´¨é‡å’Œå®æ—¶æ€§

## åã€ä¸‹ä¸€æ­¥

æ•°æ®å‡†å¤‡å®Œæˆåï¼Œè¯·ç»§ç»­é˜…è¯»ï¼š
- **[03-åŸºç¡€ä½¿ç”¨.md](03-åŸºç¡€ä½¿ç”¨.md)** - å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Qlib è¿›è¡Œæ•°æ®æŸ¥è¯¢

## åä¸€ã€æ•°æ®å‡†å¤‡æ£€æŸ¥æ¸…å•

åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] å·²æˆåŠŸä¸‹è½½ A è‚¡æ•°æ®ï¼ˆæˆ–ç¾è‚¡æ•°æ®ï¼‰
- [ ] æ•°æ®ç›®å½•ç»“æ„æ­£ç¡®
- [ ] æ•°æ®éªŒè¯è„šæœ¬è¿è¡ŒæˆåŠŸ
- [ ] èƒ½å¤Ÿæ­£å¸¸æŸ¥è¯¢æ•°æ®

å¦‚æœæ‰€æœ‰é¡¹ç›®éƒ½å·²å®Œæˆï¼Œæ•°æ®å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ Qlib è¿›è¡Œé‡åŒ–ç ”ç©¶äº†ï¼
